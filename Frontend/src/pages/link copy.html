<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Links</title>
</head>
<body>
    <h1>Gerenciar Links</h1>

    <!-- Formulário para criar ou editar link -->
    <h2>Cadastrar ou Editar Link</h2>
    <form id="linkForm">
        <input type="hidden" id="linkId"> <!-- Campo oculto para o ID do link em edição -->
        <label for="title">Título:</label>
        <input type="text" id="title" required><br><br>
        
        <label for="url">URL:</label>
        <input type="url" id="url" required><br><br>
        
        <label for="description">Descrição:</label>
        <textarea id="description"></textarea><br><br>
        
        <label for="tags">Tags (separadas por vírgula):</label>
        <input type="text" id="tags"><br><br>
        
        <button type="submit">Salvar Link</button>
    </form>

    <h2>Links Cadastrados</h2>
    <div id="links-container"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getDatabase, ref, set, get, child, remove } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBZ8CYtyp5jeDCZ1us73wKTKP-tMggQI9k",
            authDomain: "mylist-47c5d.firebaseapp.com",
            databaseURL: "https://mylist-47c5d-default-rtdb.firebaseio.com",
            projectId: "mylist-47c5d",
            storageBucket: "mylist-47c5d.firebasestorage.app",
            messagingSenderId: "788524449781",
            appId: "1:788524449781:web:02f8905320a4c8c956eabc",
            measurementId: "G-N2E344W9V4"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Função para adicionar ou atualizar um link
        function saveLink(linkId, title, url, description, tags) {
            const linkRef = ref(database, 'links/' + linkId);
            set(linkRef, {
                title: title,
                url: url,
                description: description,
                tags: tags.split(',').map(tag => tag.trim()),  // Convertendo as tags em um array
                createdAt: new Date().toISOString(),
                accessCount: 0
            }).then(() => {
                alert('Link salvo com sucesso!');
                loadLinks();  // Atualiza a lista de links
                document.getElementById("linkForm").reset();  // Limpa o formulário
            }).catch((error) => {
                alert('Erro ao salvar link: ' + error.message);
            });
        }

        // Função para deletar um link
        function deleteLink(linkId) {
            const linkRef = ref(database, 'links/' + linkId);
            remove(linkRef).then(() => {
                alert('Link deletado com sucesso!');
                loadLinks();  // Atualiza a lista de links
            }).catch((error) => {
                alert('Erro ao deletar link: ' + error.message);
            });
        }

        // Função para carregar todos os links e exibi-los
        function loadLinks() {
            const linksContainer = document.getElementById('links-container');
            linksContainer.innerHTML = '';  // Limpa o conteúdo atual

            const linksRef = ref(database, 'links');
            get(linksRef).then((snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((linkSnapshot) => {
                        const link = linkSnapshot.val();
                        const linkId = linkSnapshot.key;

                        const linkElement = document.createElement('div');
                        linkElement.classList.add('link-item');

                        const titleElement = document.createElement('h3');
                        titleElement.textContent = link.title;

                        const urlElement = document.createElement('a');
                        urlElement.href = link.url;
                        urlElement.textContent = link.url;
                        urlElement.target = '_blank';

                        const descriptionElement = document.createElement('p');
                        descriptionElement.textContent = link.description || 'Sem descrição';

                        const editButton = document.createElement('button');
                        editButton.textContent = 'Editar';
                        editButton.onclick = () => {
                            document.getElementById("linkId").value = linkId;
                            document.getElementById("title").value = link.title;
                            document.getElementById("url").value = link.url;
                            document.getElementById("description").value = link.description;
                            document.getElementById("tags").value = link.tags.join(', ');
                        };

                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Deletar';
                        deleteButton.onclick = () => {
                            if (confirm('Tem certeza que deseja deletar este link?')) {
                                deleteLink(linkId);
                            }
                        };

                        linkElement.appendChild(titleElement);
                        linkElement.appendChild(urlElement);
                        linkElement.appendChild(descriptionElement);
                        linkElement.appendChild(editButton);
                        linkElement.appendChild(deleteButton);

                        linksContainer.appendChild(linkElement);
                    });
                } else {
                    linksContainer.innerHTML = 'Nenhum link encontrado.';
                }
            }).catch((error) => {
                alert('Erro ao carregar links: ' + error.message);
            });
        }

        // Função para ser chamada ao submeter o formulário
        document.getElementById('linkForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const linkId = document.getElementById("linkId").value || Date.now().toString();  // Gerar ID único para novos links
            const title = document.getElementById("title").value;
            const url = document.getElementById("url").value;
            const description = document.getElementById("description").value;
            const tags = document.getElementById("tags").value;

            saveLink(linkId, title, url, description, tags);
        });

        // Carregar links ao carregar a página
        window.onload = loadLinks;
    </script>
</body>
</html>
